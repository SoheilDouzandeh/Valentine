<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ÙˆÙ„Ù†ØªØ§ÛŒÙ†</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900;1000&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#0b0b10;
  --bg2:#141425;
  --text:#ffffff;
  --yes:#19c37d;
  --no:#ff4d6d;
  --card:rgba(255,255,255,.07);
  --stroke:rgba(255,255,255,.18);
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{
  margin:0;
  font-family:"Vazirmatn",system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:var(--text);
  background:radial-gradient(1200px 800px at 50% -10%,#2a2a5a 0%,transparent 60%),
            linear-gradient(180deg,var(--bg1),var(--bg2));
  overflow:hidden;
}

.hearts{position:fixed;inset:0;pointer-events:none;z-index:0}
.heart{
  position:absolute;
  bottom:-60px;
  font-size:18px;
  animation:floatUp linear forwards;
  opacity:.9;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
}
@keyframes floatUp{
  0%{opacity:0;transform:translateY(0)}
  10%{opacity:1}
  100%{opacity:0;transform:translateY(-120vh)}
}

.wrap{
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
  position:relative;
  z-index:2;
}
.card{
  width:min(560px,92vw);
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:22px;
  padding:18px;
  text-align:center;
  backdrop-filter: blur(10px);
  box-shadow: 0 25px 60px rgba(0,0,0,.35);
}

.title{font-weight:1000;font-size:clamp(28px,7vw,44px);margin:0;line-height:1.15}
.sub{margin:10px 0 0;font-weight:700;opacity:.9}

.photoWrap{
  margin-top:14px;
  border-radius:16px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.18);
  box-shadow: 0 18px 45px rgba(0,0,0,.35);
}
.photo{
  width:100%;
  display:block;
  filter: contrast(1.25) brightness(1.06) saturate(1.05);
}

.btnRow{
  margin-top:16px;
  position:relative;
  height:104px;
  display:flex;
  align-items:center;
  justify-content:center;
}

button{
  font-weight:1000;
  font-size:18px;
  padding:14px 22px;
  border:none;
  border-radius:16px;
  cursor:pointer;
  min-width:130px;
}
#yesBtn{
  background:linear-gradient(180deg,#2be39a,var(--yes));
  color:#052013;
  box-shadow: 0 18px 30px rgba(25,195,125,.25);
}
#noBtn{
  background:linear-gradient(180deg,#ff6b86,var(--no));
  color:#2b0010;
  position:absolute;
  left:12px;
  top:10px;
  user-select:none;
  touch-action:none;
  box-shadow: 0 18px 30px rgba(255,77,109,.22);
}

/* Smaller NO on mobile */
@media (max-width:480px){
  #noBtn{ font-size:14px; padding:8px 12px; min-width:80px; border-radius:14px; }
  .btnRow{ height: 112px; }
}

/* Celebration overlay with smooth fade */
.celebrate{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:22px;
  z-index:5;

  /* start hidden but mounted */
  opacity:0;
  pointer-events:none;
  background:rgba(0,0,0,.82);
  transition: opacity 420ms ease;
}
.celebrate.on{
  opacity:1;
  pointer-events:auto;
}

.celebrateCard{
  width:min(560px,92vw);
  background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.18);
  border-radius:22px;
  padding:18px 16px 16px;
  text-align:center;
  box-shadow: 0 30px 70px rgba(0,0,0,.55);
  backdrop-filter: blur(10px);

  transform: translateY(10px) scale(.98);
  transition: transform 420ms ease;
}
.celebrate.on .celebrateCard{
  transform: translateY(0) scale(1);
}

.bigMsg{
  font-size:clamp(26px,7vw,46px);
  font-weight:1000;
  margin:0;
}

.videoWrap{
  margin-top:14px;
  display:flex;
  justify-content:center;
}
.videoWrap video{
  width:min(320px,84vw);
  border-radius:18px;
  border: 1px solid rgba(255,255,255,.18);
  box-shadow: 0 22px 50px rgba(0,0,0,.45);

  /* fade the video itself */
  opacity:0;
  transform: scale(.98);
  transition: opacity 520ms ease, transform 520ms ease;
}
.celebrate.on .videoWrap video{
  opacity:1;
  transform: scale(1);
}
</style>
</head>

<body>

<!-- AUDIO (repo root): valentine.mp3 -->
<audio id="bgMusic" preload="auto">
  <source src="valentine.mp3" type="audio/mpeg">
</audio>

<div class="hearts" id="hearts"></div>

<div class="wrap">
  <div class="card">
    <h1 class="title">ÙØ§Ø·Ù…Ù‡ ÙˆÙ„Ù†ØªØ§ÛŒÙ† Ù…Ù† Ù…ÛŒØ´ÛŒâ€ŒØŸ</h1>
    <p class="sub">ÙÙ‚Ø· ÛŒÙ‡ Ú¯Ø²ÛŒÙ†Ù‡ Ø¯Ø±Ø³Øª ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù‡ ğŸ˜Œ</p>

    <div class="photoWrap">
      <img class="photo" src="whiteboard_enhanced.jpg" alt="whiteboard">
    </div>

    <div class="btnRow" id="btnArea">
      <button id="yesBtn">Ø¢Ø±Ù‡</button>
      <button id="noBtn" aria-disabled="true">Ù†Ù‡</button>
    </div>
  </div>
</div>

<!-- Fade-in overlay is always in DOM, just hidden until YES -->
<div class="celebrate" id="celebrate" aria-hidden="true">
  <div class="celebrateCard">
    <p class="bigMsg">Ù…ÛŒâ€ŒØ¯ÙˆÙ†Ø³ØªÙ… Ø¯ÙˆØ³ØªÙ… Ø¯Ø§Ø±ÛŒ ğŸ’–</p>

    <div class="videoWrap">
      <!-- Put your video in repo root as baby.mp4 -->
      <video id="babyVid" src="baby.mp4" loop playsinline preload="auto"></video>
    </div>
  </div>
</div>

<script>
// Floating hearts
const heartsEl = document.getElementById("hearts");
function spawnHeart(){
  const h=document.createElement("div");
  h.className="heart";
  h.textContent="ğŸ¤";
  h.style.left=Math.random()*100+"vw";
  h.style.fontSize=(14+Math.random()*22)+"px";
  h.style.animationDuration=(5.5+Math.random()*4.5)+"s";
  heartsEl.appendChild(h);
  setTimeout(()=>h.remove(),11000);
}
setInterval(spawnHeart,220);

// Fast NO dodge (mobile tuned)
const noBtn=document.getElementById("noBtn");
const btnArea=document.getElementById("btnArea");

function moveNoButton(pointerX,pointerY){
  const area=btnArea.getBoundingClientRect();
  const btn=noBtn.getBoundingClientRect();
  const padding=6;

  const maxX=Math.max(0, area.width - btn.width - padding);
  const maxY=Math.max(0, area.height - btn.height - padding);

  let x=Math.random()*maxX + padding;
  let y=Math.random()*maxY + padding;

  if (Number.isFinite(pointerX) && Number.isFinite(pointerY)) {
    const px = pointerX - area.left;
    const py = pointerY - area.top;

    if (px < area.width/2) x = (area.width/2) + Math.random()*(area.width/2 - btn.width - padding);
    else x = Math.random()*(area.width/2 - padding);

    if (py < area.height/2) y = (area.height/2) + Math.random()*(area.height/2 - btn.height - padding);
    else y = Math.random()*(area.height/2 - padding);

    x = Math.min(Math.max(padding, x), maxX);
    y = Math.min(Math.max(padding, y), maxY);
  }

  noBtn.style.right="auto";
  noBtn.style.bottom="auto";
  noBtn.style.left=x+"px";
  noBtn.style.top=y+"px";
}

// Block any click on NO
["click","pointerdown","mousedown","touchstart"].forEach(evt=>{
  noBtn.addEventListener(evt,e=>{
    e.preventDefault();
    e.stopPropagation();
  }, {passive:false});
});

// Desktop proximity dodge
btnArea.addEventListener("pointermove",e=>{
  const b=noBtn.getBoundingClientRect();
  const dx=e.clientX-(b.left+b.width/2);
  const dy=e.clientY-(b.top+b.height/2);
  if(Math.hypot(dx,dy) < 160) moveNoButton(e.clientX,e.clientY);
});

// Mobile touch dodge (fast)
let lastDodge = 0;
function mobileDodge(t){
  const now = Date.now();
  if (now - lastDodge < 70) return;
  lastDodge = now;

  const b=noBtn.getBoundingClientRect();
  const dx=t.clientX-(b.left+b.width/2);
  const dy=t.clientY-(b.top+b.height/2);
  if(Math.hypot(dx,dy) < 220) moveNoButton(t.clientX,t.clientY);
}
btnArea.addEventListener("touchstart",e=>{
  const t=e.touches[0]; if(!t) return; mobileDodge(t);
},{passive:true});
btnArea.addEventListener("touchmove",e=>{
  const t=e.touches[0]; if(!t) return; mobileDodge(t);
},{passive:true});

// Ensure NO moves on load
window.addEventListener("load",()=>{
  moveNoButton();
  setTimeout(()=>moveNoButton(),200);
});

// Sync video + music on YES with smooth fade-in
const yesBtn = document.getElementById("yesBtn");
const celebrate = document.getElementById("celebrate");
const music = document.getElementById("bgMusic");
const babyVid = document.getElementById("babyVid");

async function fadeInAudio(target=1.0, ms=650){
  const steps = 20;
  const stepTime = ms/steps;
  for (let i=0;i<=steps;i++){
    music.volume = target * (i/steps);
    await new Promise(r=>setTimeout(r, stepTime));
  }
}

yesBtn.addEventListener("click", async () => {
  // show overlay (fade)
  celebrate.classList.add("on");
  celebrate.setAttribute("aria-hidden","false");

  // sync start as tightly as possible:
  // 1) reset both to 0
  // 2) start both immediately from same click
  try{
    music.pause();
    babyVid.pause();
    music.currentTime = 0;
    babyVid.currentTime = 0;

    music.loop = true;
    babyVid.loop = true;
    babyVid.muted = true; // keeps it simple; your song is the audio

    // start both immediately
    music.volume = 0.05;
    const p1 = music.play();
    const p2 = babyVid.play();

    // wait for both (if one fails it will throw)
    await Promise.all([p1, p2]);

    // smooth audio fade-in (video fades via CSS)
    await fadeInAudio(1.0, 650);

  }catch(err){
    console.log("Playback blocked:", err);
    alert("Ø§Ú¯Ù‡ Ø¢Ù‡Ù†Ú¯ ÛŒØ§ ÙˆÛŒØ¯ÛŒÙˆ Ù¾Ø®Ø´ Ù†Ø´Ø¯ØŒ ÛŒÚ© Ø¨Ø§Ø± Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ø¨Ø²Ù† ğŸ™‚");
  }
});
</script>

</body>
</html>
